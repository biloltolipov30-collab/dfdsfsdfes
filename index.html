<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Finance Empire - Финансовый симулятор</title>
    <link rel="icon" href="https://d1csarkz8obe9u.cloudfront.net/posterpreviews/logo-design-template-7b59aa2aee8a97a9eefe8b8571955ec2_screen.jpg?ts=1749019222">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #0f172a;
            --secondary: #1e293b;
            --accent: #3b82f6;
            --accent2: #10b981;
            --accent3: #f59e0b;
            --accent4: #ef4444;
            --accent5: #8b5cf6;
            --prestige-color: #eab308;
            --leaderboard-color: #8b5cf6;
            --text: #f1f5f9;
            --text-secondary: #94a3b8;
            --card-bg: rgba(30, 41, 59, 0.8);
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #0f172a, #1e293b, #334155);
            color: var(--text);
            min-height: 100vh;
            overflow-x: hidden;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image:
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(245, 158, 11, 0.1) 0%, transparent 40%);
            z-index: -1;
        }

        /* Экраны авторизации */
        .auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .auth-container {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            animation: fadeIn 0.5s ease;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(30, 41, 59, 0.5);
            padding: 5px;
            border-radius: 10px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 600;
            cursor: pointer;
            border-radius: 8px;
            transition: var(--transition);
        }

        .auth-tab.active {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            color: var(--text);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }

        .auth-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .auth-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .app-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            display: none;
        }

        /* Верхняя панель пользователя */
        .user-top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 15px 30px;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
            gap: 20px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: 700;
            color: white;
        }

        .user-details h3 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .user-details p {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .currency-display {
            display: flex;
            gap: 30px;
        }

        .currency-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .currency-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
        }

        .prestige-icon {
            background: linear-gradient(135deg, var(--prestige-color), #ca8a04);
        }

        .currency-info h3 {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .currency-value {
            font-size: 1.8rem;
            font-weight: 800;
        }

        .money-value {
            color: var(--accent3);
        }

        .prestige-value {
            color: var(--prestige-color);
        }

        .user-actions {
            display: flex;
            gap: 10px;
        }

        .user-action-button {
            padding: 10px 20px;
            background: rgba(30, 41, 59, 0.7);
            border: none;
            border-radius: 10px;
            color: var(--text);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prestige-button {
            background: linear-gradient(135deg, var(--prestige-color), #ca8a04);
            color: white;
        }

        .prestige-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(234, 179, 8, 0.3);
        }

        /* Верхнее меню */
        .header {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 10px 0;
            margin-bottom: 30px;
            border-radius: 15px;
        }

        .nav-container {
            display: flex;
            justify-content: center;
            gap: 10px;
            padding: 0 20px;
            flex-wrap: nowrap;
            overflow-x: auto;
        }

        .nav-tab {
            padding: 15px 25px;
            background: rgba(30, 41, 59, 0.7);
            border: none;
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .nav-tab:hover {
            background: rgba(59, 130, 246, 0.2);
            color: var(--text);
        }

        .nav-tab.active {
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }

        /* Основной контент */
        .main-content {
            padding: 20px 0;
        }

        /* Статистика */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
        }

        .stat-label {
            font-size: 1rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent3);
        }

        .progress-bar {
            margin-top: 15px;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent), var(--accent2));
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        /* Круг клика */
        .click-section {
            text-align: center;
            margin: 40px 0;
            position: relative;
        }

        .click-button {
            width: 280px;
            height: 280px;
            border-radius: 50%;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            color: white;
            font-size: 1.8rem;
            font-weight: 800;
            cursor: pointer;
            box-shadow:
                0 20px 40px rgba(59, 130, 246, 0.3),
                inset 0 8px 20px rgba(255, 255, 255, 0.2),
                inset 0 -8px 20px rgba(0, 0, 0, 0.3);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .click-button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .click-button:hover::after {
            opacity: 1;
        }

        .click-button:hover {
            transform: scale(1.05);
        }

        .click-button:active {
            transform: scale(0.95);
        }

        .click-value {
            font-size: 1.5rem;
            color: var(--accent3);
            font-weight: 700;
        }

        .click-multiplier {
            font-size: 1.2rem;
            color: var(--accent2);
            font-weight: 600;
        }

        /* Контент вкладок */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        /* Сетка улучшений */
        .upgrades-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .upgrade-card {
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
        }

        .upgrade-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
        }

        .upgrade-header {
            padding: 20px;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .upgrade-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .upgrade-info {
            flex: 1;
        }

        .upgrade-name {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 5px;
            color: white;
        }

        .upgrade-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .upgrade-content {
            padding: 20px;
        }

        .upgrade-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .upgrade-stat {
            text-align: center;
        }

        .stat-label-small {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .stat-value-small {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--accent3);
        }

        .upgrade-price {
            background: rgba(239, 68, 68, 0.1);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 20px;
            border: 1px solid rgba(239, 68, 68, 0.2);
            position: relative;
            overflow: hidden;
        }

        .upgrade-price::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            100% { left: 100%; }
        }

        .price-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--accent4);
        }

        .upgrade-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .upgrade-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.3);
        }

        .upgrade-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .upgrade-button:disabled {
            background: rgba(148, 163, 184, 0.2);
            color: var(--text-secondary);
            cursor: not-allowed;
        }

        .upgrade-multiplier {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(16, 185, 129, 0.2);
            color: var(--accent2);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        /* Цвета для разных типов */
        .click-type .upgrade-icon { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .real-estate-type .upgrade-icon { background: linear-gradient(135deg, #10b981, #047857); }
        .crypto-type .upgrade-icon { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .business-type .upgrade-icon { background: linear-gradient(135deg, #8b5cf6, #7c3aed); }
        .luxury-type .upgrade-icon { background: linear-gradient(135deg, #ec4899, #be185d); }

        /* Вкладка Лидеры */
        .leaderboard-container {
            margin-top: 30px;
        }

        .leaderboard-table {
            width: 100%;
            background: var(--card-bg);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .leaderboard-header {
            display: grid;
            grid-template-columns: 80px 2fr 1fr 1fr 1fr;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            font-weight: 700;
            color: var(--text);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .leaderboard-row {
            display: grid;
            grid-template-columns: 80px 2fr 1fr 1fr 1fr;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: var(--transition);
        }

        .leaderboard-row:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .leaderboard-row.current-user {
            background: rgba(59, 130, 246, 0.1);
            border-left: 4px solid var(--accent);
        }

        .rank-cell {
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2rem;
        }

        .rank-1 { color: gold; }
        .rank-2 { color: silver; }
        .rank-3 { color: #cd7f32; }

        .user-cell {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-cell-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: white;
        }

        /* Вкладка События */
        .events-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .event-card {
            background: linear-gradient(135deg, rgba(139, 92, 246, 0.1), rgba(59, 130, 246, 0.1));
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(139, 92, 246, 0.3);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(139, 92, 246, 0.2);
        }

        .event-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .event-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .event-content p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .event-timer {
            text-align: center;
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        /* Уведомления */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, var(--accent2), var(--accent));
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 10000;
            animation: slideIn 0.3s ease, fadeOut 0.3s ease 2s forwards;
            max-width: 300px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Всплывающие сообщения при клике */
        .income-popup {
            position: absolute;
            color: var(--accent3);
            font-weight: bold;
            font-size: 1.5rem;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            z-index: 100;
            text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        @keyframes floatUp {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-60px) scale(1.2); }
        }

        /* Модальные окна */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: linear-gradient(135deg, #1e293b, #0f172a);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            border: 1px solid rgba(59, 130, 246, 0.3);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
            position: relative;
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Анимации */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulse {
            animation: pulse 2s infinite;
        }

        /* Стили для достижений */
        .achievement-badge {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, var(--accent), var(--accent2));
            padding: 15px;
            border-radius: 10px;
            box-shadow: var(--shadow);
            z-index: 9999;
            animation: slideInLeft 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 300px;
        }

        @keyframes slideInLeft {
            from { transform: translateX(-100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Адаптивность */
        @media (max-width: 1024px) {
            .upgrades-grid, .events-container {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }

            .leaderboard-header,
            .leaderboard-row {
                grid-template-columns: 60px 2fr 1fr 1fr;
            }

            .leaderboard-header div:nth-child(5),
            .leaderboard-row div:nth-child(5) {
                display: none;
            }
        }

        @media (max-width: 768px) {
            .app-container {
                padding: 10px;
            }

            .user-top-bar {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }

            .user-info, .currency-display, .user-actions {
                width: 100%;
                justify-content: center;
            }

            .currency-display {
                flex-direction: column;
                gap: 15px;
            }

            .upgrades-grid, .events-container {
                grid-template-columns: 1fr;
            }

            .click-button {
                width: 220px;
                height: 220px;
                font-size: 1.5rem;
            }

            .stats-container {
                grid-template-columns: 1fr;
            }

            .nav-container {
                justify-content: flex-start;
                padding: 10px;
            }

            .nav-tab {
                padding: 12px 20px;
                font-size: 1rem;
            }

            .leaderboard-header,
            .leaderboard-row {
                grid-template-columns: 50px 2fr 1fr;
            }

            .leaderboard-header div:nth-child(4),
            .leaderboard-row div:nth-child(4) {
                display: none;
            }
        }

        @media (max-width: 576px) {
            .auth-container {
                padding: 20px;
            }

            .click-button {
                width: 200px;
                height: 200px;
                font-size: 1.3rem;
            }

            .stat-value {
                font-size: 2rem;
            }

            .nav-tab {
                padding: 10px 15px;
                font-size: 0.9rem;
            }

            .modal {
                padding: 20px;
            }
        }

        /* Анимации вкладок */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <!-- Экраны авторизации -->
    <div class="auth-screen" id="auth-screen">
        <div class="auth-container">
            <h1 style="text-align: center; margin-bottom: 30px; font-size: 2rem; color: var(--accent);">
                <i class="fas fa-crown"></i> Finance Empire
            </h1>

            <div class="auth-tabs">
                <button class="auth-tab active" data-form="login">Вход</button>
                <button class="auth-tab" data-form="register">Регистрация</button>
            </div>

            <form class="auth-form active" id="login-form">
                <div class="form-group">
                    <label for="login-username"><i class="fas fa-user"></i> Имя пользователя</label>
                    <input type="text" id="login-username" class="form-control" placeholder="Введите имя пользователя" required>
                </div>

                <div class="form-group">
                    <label for="login-password"><i class="fas fa-lock"></i> Пароль</label>
                    <input type="password" id="login-password" class="form-control" placeholder="Введите пароль" required>
                </div>

                <button type="submit" class="auth-button">
                    <i class="fas fa-sign-in-alt"></i> Войти
                </button>
            </form>

            <form class="auth-form" id="register-form">
                <div class="form-group">
                    <label for="register-username"><i class="fas fa-user"></i> Имя пользователя</label>
                    <input type="text" id="register-username" class="form-control" placeholder="Придумайте имя пользователя" required>
                </div>

                <div class="form-group">
                    <label for="register-password"><i class="fas fa-lock"></i> Пароль</label>
                    <input type="password" id="register-password" class="form-control" placeholder="Придумайте пароль" required>
                </div>

                <div class="form-group">
                    <label for="register-email"><i class="fas fa-envelope"></i> Email (необязательно)</label>
                    <input type="email" id="register-email" class="form-control" placeholder="Ваш email">
                </div>

                <button type="submit" class="auth-button">
                    <i class="fas fa-user-plus"></i> Зарегистрироваться
                </button>
            </form>

            <div style="text-align: center; margin-top: 20px; color: var(--text-secondary); font-size: 0.9rem;">
                <i class="fas fa-info-circle"></i> Данные сохраняются локально в вашем браузере
            </div>
        </div>
    </div>

    <!-- Основной интерфейс игры -->
    <div class="app-container" id="app-container">
        <!-- Верхняя панель пользователя -->
        <div class="user-top-bar">
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">U</div>
                <div class="user-details">
                    <h3 id="username-display">Пользователь</h3>
                    <p><i class="fas fa-calendar"></i> Зарегистрирован: <span id="register-date">Сегодня</span></p>
                </div>
            </div>

            <div class="currency-display">
                <div class="currency-item">
                    <div class="currency-icon">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="currency-info">
                        <h3>БАЛАНС</h3>
                        <div class="currency-value money-value" id="balance">$100</div>
                    </div>
                </div>

                <div class="currency-item">
                    <div class="currency-icon prestige-icon">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div class="currency-info">
                        <h3>ПРЕСТИЖ</h3>
                        <div class="currency-value prestige-value" id="prestige-points">0</div>
                    </div>
                </div>
            </div>

            <div class="user-actions">
                <button class="user-action-button" id="logout-button">
                    <i class="fas fa-sign-out-alt"></i> Выход
                </button>
                <button class="user-action-button prestige-button" id="prestige-button">
                    <i class="fas fa-redo"></i> Престиж
                </button>
            </div>
        </div>

        <!-- Верхнее меню -->
        <header class="header">
            <div class="nav-container">
                <button class="nav-tab active" data-tab="click">
                    <i class="fas fa-mouse-pointer"></i>
                    Улучшения
                </button>
                <button class="nav-tab" data-tab="real-estate">
                    <i class="fas fa-building"></i>
                    Недвижимость
                </button>
                <button class="nav-tab" data-tab="crypto">
                    <i class="fab fa-bitcoin"></i>
                    Криптовалюта
                </button>
                <button class="nav-tab" data-tab="business">
                    <i class="fas fa-briefcase"></i>
                    Бизнес
                </button>
                <button class="nav-tab" data-tab="luxury">
                    <i class="fas fa-gem"></i>
                    Роскошь
                </button>
                <button class="nav-tab" data-tab="events">
                    <i class="fas fa-calendar-star"></i>
                    События
                </button>
                <button class="nav-tab" data-tab="leaderboard">
                    <i class="fas fa-trophy"></i>
                    Лидеры
                </button>
            </div>
        </header>

        <!-- Основной контент -->
        <main class="main-content">
            <!-- Статистика -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-wallet"></i>
                        Баланс
                    </div>
                    <div class="stat-value" id="balance-stat">$100</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="money-progress" style="width: 5%"></div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-chart-line"></i>
                        Пассивный доход
                    </div>
                    <div class="stat-value" id="incomePerSec">$0/сек</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="income-progress" style="width: 0%"></div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-label">
                        <i class="fas fa-mouse-pointer"></i>
                        Доход за клик
                    </div>
                    <div class="stat-value" id="clickIncome">$1</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="click-progress" style="width: 10%"></div>
                    </div>
                </div>
            </div>

            <!-- Круг для кликов -->
            <div class="click-section">
                <button class="click-button" id="clickButton">
                    <div>ИНВЕСТИРОВАТЬ</div>
                    <div class="click-value" id="clickValue">+$1</div>
                    <div class="click-multiplier" id="clickMultiplier">Множитель: 1x</div>
                </button>
                <p style="color: var(--text-secondary); margin-top: 10px;">
                    <i class="fas fa-lightbulb"></i> Удерживайте клик для автокликера (разблокируется при 1000 кликах)
                </p>
            </div>

            <!-- Контент вкладок -->
            <div id="click-tab" class="tab-content active">
                <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: var(--accent);">
                    <i class="fas fa-mouse-pointer"></i> Улучшения кликов
                </h2>
                <div class="upgrades-grid" id="click-upgrades-container">
                    <!-- Улучшения клика будут загружены здесь -->
                </div>
            </div>

            <div id="real-estate-tab" class="tab-content">
                <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: var(--accent2);">
                    <i class="fas fa-building"></i> Недвижимость
                </h2>
                <div class="upgrades-grid" id="real-estate-upgrades-container">
                    <!-- Недвижимость будет загружена здесь -->
                </div>
            </div>

            <div id="crypto-tab" class="tab-content">
                <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: var(--accent3);">
                    <i class="fab fa-bitcoin"></i> Криптовалюта
                </h2>
                <div class="upgrades-grid" id="crypto-upgrades-container">
                    <!-- Криптовалюта будет загружена здесь -->
                </div>
            </div>

            <div id="business-tab" class="tab-content">
                <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: var(--accent);">
                    <i class="fas fa-briefcase"></i> Бизнес
                </h2>
                <div class="upgrades-grid" id="business-upgrades-container">
                    <!-- Бизнес будет загружен здесь -->
                </div>
            </div>

            <div id="luxury-tab" class="tab-content">
                <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: var(--accent4);">
                    <i class="fas fa-gem"></i> Роскошь
                </h2>
                <div class="upgrades-grid" id="luxury-upgrades-container">
                    <!-- Роскошь будет загружена здесь -->
                </div>
            </div>

            <!-- Вкладка События -->
            <div id="events-tab" class="tab-content">
                <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: var(--accent5);">
                    <i class="fas fa-calendar-star"></i> Специальные события
                </h2>
                <div class="events-container" id="events-container">
                    <!-- События будут загружены здесь -->
                </div>
            </div>

            <!-- Вкладка Лидеры -->
            <div id="leaderboard-tab" class="tab-content">
                <h2 style="font-size: 1.8rem; margin-bottom: 20px; color: var(--leaderboard-color);">
                    <i class="fas fa-trophy"></i> Топ игроков
                </h2>
                <div class="leaderboard-container">
                    <div class="leaderboard-table" id="leaderboard-table">
                        <!-- Лидерборд будет загружен здесь -->
                    </div>
                    <div style="text-align: center; color: var(--text-secondary);">
                        <i class="fas fa-info-circle"></i> Рейтинг обновляется каждые 5 минут
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Модальное окно престижа -->
    <div class="modal-overlay" id="prestige-modal">
        <div class="modal">
            <button class="modal-close" id="modal-close">
                <i class="fas fa-times"></i>
            </button>
            <h2 style="font-size: 2rem; color: var(--prestige-color); margin-bottom: 20px; text-align: center;">
                <i class="fas fa-crown"></i> Система Престижа
            </h2>
            <div style="text-align: center; margin-bottom: 30px;">
                <div style="font-size: 3rem; color: var(--prestige-color); font-weight: 800; margin-bottom: 10px;" id="prestige-reward">0</div>
                <p style="color: var(--text-secondary);">очков престижа за эту итерацию</p>
            </div>
            <div style="background: rgba(234, 179, 8, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 30px;">
                <h3 style="color: var(--prestige-color); margin-bottom: 10px;">Преимущества:</h3>
                <ul style="color: var(--text-secondary); line-height: 1.6; padding-left: 20px;">
                    <li>Постоянный множитель дохода: <span id="prestige-multiplier">1x</span></li>
                    <li>Начинаете с бонусными деньгами</li>
                    <li><span id="new-upgrades-count">0</span> новых улучшений разблокировано</li>
                    <li>Особые достижения и награды</li>
                </ul>
                <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.3); border-radius: 8px;">
                    <p style="color: var(--accent3); font-size: 0.9rem;">
                        <i class="fas fa-star"></i> Каждые 10 престижей разблокируются новые улучшения!
                    </p>
                    <p style="color: var(--accent2); font-size: 0.9rem; margin-top: 5px;">
                        <i class="fas fa-calendar-star"></i> Каждые 50 престижей открываются новые события!
                    </p>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="auth-button prestige-button" style="padding: 15px 40px; font-size: 1.2rem;" id="confirm-prestige">
                    <i class="fas fa-redo"></i>
                    Перезапустить игру
                </button>
                <p style="color: var(--text-secondary); margin-top: 15px; font-size: 0.9rem;">
                    Вы потеряете все деньги и улучшения, но сохраните очки престижа и достижения
                </p>
            </div>
        </div>
    </div>

    <script>
        // ================== СИСТЕМА ПОЛЬЗОВАТЕЛЕЙ ==================
        class UserSystem {
            constructor() {
                this.currentUser = null;
                this.users = JSON.parse(localStorage.getItem('financeEmpireUsers')) || [];
                this.leaderboard = JSON.parse(localStorage.getItem('financeEmpireLeaderboard')) || [];
            }

            register(username, password, email = '') {
                // Проверяем, существует ли пользователь
                if (this.users.find(u => u.username.toLowerCase() === username.toLowerCase())) {
                    return { success: false, message: 'Пользователь с таким именем уже существует' };
                }

                // Создаем нового пользователя
                const newUser = {
                    id: Date.now().toString(),
                    username: username,
                    password: password, // В реальном приложении нужно хэшировать пароль!
                    email: email,
                    registerDate: new Date().toISOString(),
                    gameData: this.getDefaultGameData(),
                    lastLogin: new Date().toISOString()
                };

                this.users.push(newUser);
                this.saveUsers();

                // Обновляем лидерборд
                this.updateLeaderboard(newUser);

                return { success: true, user: newUser };
            }

            login(username, password) {
                const user = this.users.find(u =>
                    u.username.toLowerCase() === username.toLowerCase() &&
                    u.password === password
                );

                if (!user) {
                    return { success: false, message: 'Неверное имя пользователя или пароль' };
                }

                // Обновляем время последнего входа
                user.lastLogin = new Date().toISOString();
                this.saveUsers();

                this.currentUser = user;
                return { success: true, user: user };
            }

            logout() {
                this.saveCurrentUser();
                this.currentUser = null;
            }

            saveCurrentUser() {
                if (this.currentUser) {
                    const index = this.users.findIndex(u => u.id === this.currentUser.id);
                    if (index !== -1) {
                        this.users[index] = this.currentUser;
                        this.saveUsers();

                        // Обновляем лидерборд
                        this.updateLeaderboard(this.currentUser);
                    }
                }
            }

            updateLeaderboard(user) {
                const existingIndex = this.leaderboard.findIndex(u => u.userId === user.id);

                const leaderboardEntry = {
                    userId: user.id,
                    username: user.username,
                    prestigeLevel: user.gameData.prestigeLevel || 0,
                    prestigePoints: user.gameData.prestigePoints || 0,
                    totalMoney: this.calculateTotalMoney(user.gameData),
                    lastUpdated: new Date().toISOString()
                };

                if (existingIndex !== -1) {
                    this.leaderboard[existingIndex] = leaderboardEntry;
                } else {
                    this.leaderboard.push(leaderboardEntry);
                }

                // Сортируем по уровню престижа, затем по деньгам
                this.leaderboard.sort((a, b) => {
                    if (b.prestigeLevel !== a.prestigeLevel) {
                        return b.prestigeLevel - a.prestigeLevel;
                    }
                    return b.totalMoney - a.totalMoney;
                });

                // Ограничиваем топ 100 игроков
                this.leaderboard = this.leaderboard.slice(0, 100);

                this.saveLeaderboard();
            }

            calculateTotalMoney(gameData) {
                // Рассчитываем общую заработанную сумму
                const currentMoney = gameData.money || 100;
                const upgradesCost = this.calculateUpgradesCost(gameData);
                return currentMoney + upgradesCost;
            }

            calculateUpgradesCost(gameData) {
                let total = 0;
                Object.entries(gameData.upgrades || {}).forEach(([upgradeId, level]) => {
                    // Находим улучшение и считаем общую стоимость
                    const upgrade = this.findUpgradeById(parseInt(upgradeId));
                    if (upgrade) {
                        for (let i = 0; i < level; i++) {
                            total += upgrade.basePrice * Math.pow(upgrade.priceMultiplier, i);
                        }
                    }
                });
                return total;
            }

            findUpgradeById(id) {
                // Поиск улучшения по ID во всех категориях
                const allCategories = [
                    ...gameData.clickUpgrades,
                    ...gameData.realEstateUpgrades,
                    ...gameData.cryptoUpgrades,
                    ...gameData.businessUpgrades,
                    ...gameData.luxuryUpgrades
                ];
                return allCategories.find(u => u.id === id);
            }

            getDefaultGameData() {
                return {
                    money: 100,
                    prestigePoints: 0,
                    prestigeLevel: 0,
                    clickIncome: 1,
                    passiveIncome: 0,
                    totalClicks: 0,
                    totalUpgrades: 0,
                    upgrades: {},
                    achievements: [...achievements],
                    events: {
                        saleActive: false,
                        boostActive: false,
                        lastBonusTime: 0
                    },
                    clickMultiplier: 1,
                    autoClicker: false,
                    holdClickEnabled: false,
                    unlockedPrestigeUpgrades: []
                };
            }

            saveUsers() {
                localStorage.setItem('financeEmpireUsers', JSON.stringify(this.users));
            }

            saveLeaderboard() {
                localStorage.setItem('financeEmpireLeaderboard', JSON.stringify(this.leaderboard));
            }
        }

        // ================== ДАННЫЕ ИГРЫ ==================
        const gameData = {
            clickUpgrades: [
                {
                    id: 1,
                    name: "Базовый курс инвестирования",
                    description: "Изучите основы инвестирования",
                    basePrice: 10,
                    priceMultiplier: 1.15,
                    incomePerLevel: 0.5,
                    maxLevel: 50,
                    icon: "fas fa-graduation-cap",
                    prestigeUnlock: 0
                },
                {
                    id: 2,
                    name: "Финансовый аналитик",
                    description: "Нанять финансового аналитика",
                    basePrice: 100,
                    priceMultiplier: 1.18,
                    incomePerLevel: 2,
                    maxLevel: 40,
                    icon: "fas fa-chart-pie",
                    prestigeUnlock: 0
                },
                {
                    id: 3,
                    name: "Автоматизированный инвестор",
                    description: "Автоматическая система инвестиций",
                    basePrice: 500,
                    priceMultiplier: 1.2,
                    incomePerLevel: 10,
                    maxLevel: 30,
                    icon: "fas fa-robot",
                    prestigeUnlock: 0
                },
                {
                    id: 4,
                    name: "Хедж-фонд",
                    description: "Управляйте собственным фондом",
                    basePrice: 5000,
                    priceMultiplier: 1.25,
                    incomePerLevel: 50,
                    maxLevel: 20,
                    icon: "fas fa-landmark",
                    prestigeUnlock: 0
                },
                {
                    id: 21,
                    name: "Квантовый трейдер",
                    description: "ИИ на квантовых алгоритмах",
                    basePrice: 100000,
                    priceMultiplier: 1.3,
                    incomePerLevel: 500,
                    maxLevel: 10,
                    icon: "fas fa-atom",
                    prestigeUnlock: 1
                },
                {
                    id: 26,
                    name: "Интергалактический банк",
                    description: "Банковская система между галактиками",
                    basePrice: 5000000,
                    priceMultiplier: 1.4,
                    incomePerLevel: 10000,
                    maxLevel: 5,
                    icon: "fas fa-globe-americas",
                    prestigeUnlock: 10
                },
                {
                    id: 31,
                    name: "Темная материя трейдинг",
                    description: "Торговля темной материей вселенной",
                    basePrice: 100000000,
                    priceMultiplier: 1.5,
                    incomePerLevel: 500000,
                    maxLevel: 3,
                    icon: "fas fa-infinity",
                    prestigeUnlock: 20
                }
            ],

            realEstateUpgrades: [
                {
                    id: 5,
                    name: "Квартира в Москве",
                    description: "Элитная квартира в центре",
                    basePrice: 1000,
                    priceMultiplier: 1.15,
                    incomePerLevel: 5,
                    maxLevel: 30,
                    icon: "fas fa-home",
                    prestigeUnlock: 0
                },
                {
                    id: 6,
                    name: "Загородный дом",
                    description: "Роскошный загородный дом",
                    basePrice: 10000,
                    priceMultiplier: 1.18,
                    incomePerLevel: 25,
                    maxLevel: 20,
                    icon: "fas fa-city",
                    prestigeUnlock: 0
                },
                {
                    id: 7,
                    name: "Апартаменты в Нью-Йорке",
                    description: "Апартаменты на Манхэттене",
                    basePrice: 50000,
                    priceMultiplier: 1.2,
                    incomePerLevel: 100,
                    maxLevel: 15,
                    icon: "fas fa-building",
                    prestigeUnlock: 0
                },
                {
                    id: 8,
                    name: "Пентхаус в Дубае",
                    description: "Роскошный пентхаус",
                    basePrice: 250000,
                    priceMultiplier: 1.25,
                    incomePerLevel: 500,
                    maxLevel: 10,
                    icon: "fas fa-hotel",
                    prestigeUnlock: 0
                },
                {
                    id: 22,
                    name: "Лунная недвижимость",
                    description: "Участок на Луне",
                    basePrice: 10000000,
                    priceMultiplier: 1.5,
                    incomePerLevel: 10000,
                    maxLevel: 3,
                    icon: "fas fa-moon",
                    prestigeUnlock: 1
                },
                {
                    id: 27,
                    name: "Планетарный отель Марс",
                    description: "Люкс-отель на Марсе",
                    basePrice: 50000000,
                    priceMultiplier: 1.6,
                    incomePerLevel: 50000,
                    maxLevel: 3,
                    icon: "fas fa-planet-ringed",
                    prestigeUnlock: 10
                },
                {
                    id: 32,
                    name: "Искусственная планета",
                    description: "Создание собственной планеты",
                    basePrice: 1000000000,
                    priceMultiplier: 1.8,
                    incomePerLevel: 1000000,
                    maxLevel: 1,
                    icon: "fas fa-globe-stand",
                    prestigeUnlock: 20
                }
            ],

            cryptoUpgrades: [
                {
                    id: 9,
                    name: "Bitcoin (BTC)",
                    description: "Первая криптовалюта",
                    basePrice: 5000,
                    priceMultiplier: 1.2,
                    incomePerLevel: 10,
                    maxLevel: 50,
                    icon: "fab fa-bitcoin",
                    prestigeUnlock: 0
                },
                {
                    id: 10,
                    name: "Ethereum (ETH)",
                    description: "Платформа для смарт-контрактов",
                    basePrice: 3000,
                    priceMultiplier: 1.18,
                    incomePerLevel: 15,
                    maxLevel: 40,
                    icon: "fab fa-ethereum",
                    prestigeUnlock: 0
                },
                {
                    id: 11,
                    name: "Cardano (ADA)",
                    description: "Криптовалюта с научным подходом",
                    basePrice: 1000,
                    priceMultiplier: 1.15,
                    incomePerLevel: 5,
                    maxLevel: 60,
                    icon: "fas fa-chart-network",
                    prestigeUnlock: 0
                },
                {
                    id: 12,
                    name: "Крипто-портфель",
                    description: "Диверсифицированный портфель",
                    basePrice: 25000,
                    priceMultiplier: 1.25,
                    incomePerLevel: 100,
                    maxLevel: 20,
                    icon: "fas fa-coins",
                    prestigeUnlock: 0
                },
                {
                    id: 23,
                    name: "Квантовые деньги",
                    description: "Криптовалюта на квантовой защите",
                    basePrice: 500000,
                    priceMultiplier: 1.35,
                    incomePerLevel: 2500,
                    maxLevel: 5,
                    icon: "fas fa-shield-alt",
                    prestigeUnlock: 1
                },
                {
                    id: 28,
                    name: "Галактический токен",
                    description: "Межгалактическая криптовалюта",
                    basePrice: 25000000,
                    priceMultiplier: 1.5,
                    incomePerLevel: 100000,
                    maxLevel: 3,
                    icon: "fas fa-stars",
                    prestigeUnlock: 10
                },
                {
                    id: 33,
                    name: "Универсальная валюта",
                    description: "Абсолютная валюта мироздания",
                    basePrice: 500000000,
                    priceMultiplier: 1.7,
                    incomePerLevel: 5000000,
                    maxLevel: 2,
                    icon: "fas fa-universal-access",
                    prestigeUnlock: 20
                }
            ],

            businessUpgrades: [
                {
                    id: 13,
                    name: "Кофейня Starbucks",
                    description: "Франшиза кофеен",
                    basePrice: 15000,
                    priceMultiplier: 1.18,
                    incomePerLevel: 30,
                    maxLevel: 30,
                    icon: "fas fa-coffee",
                    prestigeUnlock: 0
                },
                {
                    id: 14,
                    name: "Фитнес-центр",
                    description: "Современный фитнес-центр",
                    basePrice: 50000,
                    priceMultiplier: 1.2,
                    incomePerLevel: 75,
                    maxLevel: 20,
                    icon: "fas fa-dumbbell",
                    prestigeUnlock: 0
                },
                {
                    id: 15,
                    name: "IT-компания",
                    description: "Разработка ПО",
                    basePrice: 200000,
                    priceMultiplier: 1.22,
                    incomePerLevel: 300,
                    maxLevel: 15,
                    icon: "fas fa-laptop-code",
                    prestigeUnlock: 0
                },
                {
                    id: 16,
                    name: "Международная корпорация",
                    description: "Корпорация с филиалами",
                    basePrice: 1000000,
                    priceMultiplier: 1.3,
                    incomePerLevel: 2500,
                    maxLevel: 5,
                    icon: "fas fa-globe",
                    prestigeUnlock: 0
                },
                {
                    id: 24,
                    name: "Космическая корпорация",
                    description: "Освоение космоса и ресурсов",
                    basePrice: 50000000,
                    priceMultiplier: 1.4,
                    incomePerLevel: 50000,
                    maxLevel: 3,
                    icon: "fas fa-rocket",
                    prestigeUnlock: 1
                },
                {
                    id: 29,
                    name: "Интергалактическая корпорация",
                    description: "Торговля между галактиками",
                    basePrice: 250000000,
                    priceMultiplier: 1.6,
                    incomePerLevel: 500000,
                    maxLevel: 2,
                    icon: "fas fa-galaxy",
                    prestigeUnlock: 10
                },
                {
                    id: 34,
                    name: "Корпорация параллельных вселенных",
                    description: "Бизнес в параллельных измерениях",
                    basePrice: 10000000000,
                    priceMultiplier: 2.0,
                    incomePerLevel: 50000000,
                    maxLevel: 1,
                    icon: "fas fa-layer-group",
                    prestigeUnlock: 20
                }
            ],

            luxuryUpgrades: [
                {
                    id: 17,
                    name: "Ferrari LaFerrari",
                    description: "Эксклюзивный гиперкар",
                    basePrice: 2000000,
                    priceMultiplier: 1.3,
                    incomePerLevel: 1000,
                    maxLevel: 3,
                    icon: "fas fa-car",
                    prestigeUnlock: 0
                },
                {
                    id: 18,
                    name: "Частная яхта",
                    description: "Роскошная яхта",
                    basePrice: 10000000,
                    priceMultiplier: 1.35,
                    incomePerLevel: 5000,
                    maxLevel: 2,
                    icon: "fas fa-ship",
                    prestigeUnlock: 0
                },
                {
                    id: 19,
                    name: "Частный самолет",
                    description: "Бизнес-джет",
                    basePrice: 50000000,
                    priceMultiplier: 1.4,
                    incomePerLevel: 25000,
                    maxLevel: 1,
                    icon: "fas fa-plane",
                    prestigeUnlock: 0
                },
                {
                    id: 20,
                    name: "Частный остров",
                    description: "Собственный остров",
                    basePrice: 100000000,
                    priceMultiplier: 1.5,
                    incomePerLevel: 100000,
                    maxLevel: 1,
                    icon: "fas fa-umbrella-beach",
                    prestigeUnlock: 0
                },
                {
                    id: 25,
                    name: "Космическая яхта",
                    description: "Частный космический корабль",
                    basePrice: 500000000,
                    priceMultiplier: 1.6,
                    incomePerLevel: 500000,
                    maxLevel: 1,
                    icon: "fas fa-user-astronaut",
                    prestigeUnlock: 1
                },
                {
                    id: 30,
                    name: "Планетарный круизер",
                    description: "Путешествия между планетами",
                    basePrice: 5000000000,
                    priceMultiplier: 1.8,
                    incomePerLevel: 5000000,
                    maxLevel: 1,
                    icon: "fas fa-satellite",
                    prestigeUnlock: 10
                },
                {
                    id: 35,
                    name: "Дворец на черной дыре",
                    description: "Эксклюзивная резиденция",
                    basePrice: 100000000000,
                    priceMultiplier: 2.5,
                    incomePerLevel: 100000000,
                    maxLevel: 1,
                    icon: "fas fa-black-hole",
                    prestigeUnlock: 20
                }
            ]
        };

        // ================== СИСТЕМА СОБЫТИЙ ==================
        const eventSystem = {
            basicEvents: [
                {
                    id: 1,
                    name: "Сезонная распродажа",
                    description: "Все улучшения -20% на 1 минуту",
                    duration: 60000,
                    icon: "fas fa-bullseye",
                    color: "#10b981",
                    type: "sale"
                },
                {
                    id: 2,
                    name: "Клик-буст",
                    description: "Доход за клик x2 на 30 секунд",
                    duration: 30000,
                    icon: "fas fa-rocket",
                    color: "#f59e0b",
                    type: "boost"
                },
                {
                    id: 3,
                    name: "Ежедневный бонус",
                    description: "Заберите бонус раз в 24 часа",
                    duration: 86400000,
                    icon: "fas fa-gift",
                    color: "#ef4444",
                    type: "bonus"
                }
            ],

            // Новые события разблокируются каждые 50 престижей
            prestigeEvents: [
                {
                    id: 10,
                    name: "Галактическая лихорадка",
                    description: "Все доходы x5 на 2 минуты (50+ престиж)",
                    duration: 120000,
                    icon: "fas fa-galaxy",
                    color: "#8b5cf6",
                    type: "galaxy",
                    prestigeRequired: 50
                },
                {
                    id: 11,
                    name: "Временной разрыв",
                    description: "Время ускоряется в 10 раз на 1 минуту (100+ престиж)",
                    duration: 60000,
                    icon: "fas fa-hourglass-half",
                    color: "#06b6d4",
                    type: "timewarp",
                    prestigeRequired: 100
                },
                {
                    id: 12,
                    name: "Квантовое изобилие",
                    description: "Бесплатные улучшения на 30 секунд (150+ престиж)",
                    duration: 30000,
                    icon: "fas fa-atom",
                    color: "#ec4899",
                    type: "quantum",
                    prestigeRequired: 150
                },
                {
                    id: 13,
                    name: "Абсолютное господство",
                    description: "Максимальные уровни всех улучшений на 15 секунд (200+ престиж)",
                    duration: 15000,
                    icon: "fas fa-crown",
                    color: "#eab308",
                    type: "dominance",
                    prestigeRequired: 200
                }
            ],

            getAvailableEvents(prestigeLevel) {
                const available = [...this.basicEvents];

                // Добавляем события, которые разблокированы по престижу
                this.prestigeEvents.forEach(event => {
                    if (prestigeLevel >= event.prestigeRequired) {
                        available.push(event);
                    }
                });

                return available;
            }
        };

        // ================== ДОСТИЖЕНИЯ ==================
        const achievements = [
            { id: 1, name: "Первый миллионер", description: "Заработайте 1,000,000$", reward: 10, completed: false },
            { id: 2, name: "Клик-мастер", description: "Сделайте 10,000 кликов", reward: 5, completed: false },
            { id: 3, name: "Инвестор", description: "Купите 50 улучшений", reward: 15, completed: false },
            { id: 4, name: "Крипто-король", description: "Максимально улучшите Bitcoin", reward: 20, completed: false },
            { id: 5, name: "Первый престиж", description: "Выполните первое престиж-обновление", reward: 50, completed: false },
            { id: 6, name: "Властелин недвижимости", description: "Купите все улучшения недвижимости", reward: 30, completed: false },
            { id: 7, name: "Империя бизнеса", description: "Купите все бизнес-улучшения", reward: 40, completed: false },
            { id: 8, name: "Король роскоши", description: "Купите все предметы роскоши", reward: 50, completed: false },
            { id: 9, name: "10 уровней престижа", description: "Достигните 10 уровня престижа", reward: 100, completed: false },
            { id: 10, name: "50 уровней престижа", description: "Достигните 50 уровня престижа", reward: 500, completed: false }
        ];

        // ================== ГЛОБАЛЬНЫЕ ПЕРЕМЕННЫЕ ==================
        let userSystem = new UserSystem();
        let gameState = null;
        let currentActiveEvents = [];
        let eventTimers = {};

        // ================== DOM ЭЛЕМЕНТЫ ==================
        const authScreen = document.getElementById('auth-screen');
        const appContainer = document.getElementById('app-container');
        const authTabs = document.querySelectorAll('.auth-tab');
        const authForms = document.querySelectorAll('.auth-form');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const usernameDisplay = document.getElementById('username-display');
        const userAvatar = document.getElementById('user-avatar');
        const registerDate = document.getElementById('register-date');
        const balanceElement = document.getElementById('balance');
        const balanceStatElement = document.getElementById('balance-stat');
        const prestigeElement = document.getElementById('prestige-points');
        const incomePerSecElement = document.getElementById('incomePerSec');
        const clickIncomeElement = document.getElementById('clickIncome');
        const clickValueElement = document.getElementById('clickValue');
        const clickMultiplierElement = document.getElementById('clickMultiplier');
        const clickButton = document.getElementById('clickButton');
        const logoutButton = document.getElementById('logout-button');
        const prestigeButton = document.getElementById('prestige-button');
        const prestigeModal = document.getElementById('prestige-modal');
        const modalClose = document.getElementById('modal-close');
        const confirmPrestige = document.getElementById('confirm-prestige');
        const prestigeRewardElement = document.getElementById('prestige-reward');
        const prestigeMultiplierElement = document.getElementById('prestige-multiplier');
        const newUpgradesCountElement = document.getElementById('new-upgrades-count');

        // ================== СИСТЕМА АУТЕНТИФИКАЦИИ ==================
        function initAuth() {
            // Переключение между вкладками входа/регистрации
            authTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const formId = tab.getAttribute('data-form');

                    authTabs.forEach(t => t.classList.remove('active'));
                    authForms.forEach(f => f.classList.remove('active'));

                    tab.classList.add('active');
                    document.getElementById(`${formId}-form`).classList.add('active');
                });
            });

            // Обработка входа
            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;

                const result = userSystem.login(username, password);
                if (result.success) {
                    gameState = result.user.gameData;
                    showApp(result.user);
                } else {
                    showNotification(result.message, 'error');
                }
            });

            // Обработка регистрации
            registerForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const username = document.getElementById('register-username').value;
                const password = document.getElementById('register-password').value;
                const email = document.getElementById('register-email').value;

                const result = userSystem.register(username, password, email);
                if (result.success) {
                    gameState = result.user.gameData;
                    showApp(result.user);
                    showNotification('Регистрация успешна! Добро пожаловать в Finance Empire!', 'success');
                } else {
                    showNotification(result.message, 'error');
                }
            });

            // Выход из системы
            logoutButton.addEventListener('click', () => {
                userSystem.logout();
                authScreen.style.display = 'flex';
                appContainer.style.display = 'none';
            });
        }

        // ================== ПОКАЗ ИГРОВОГО ИНТЕРФЕЙСА ==================
        function showApp(user) {
            // Обновляем информацию пользователя
            usernameDisplay.textContent = user.username;
            userAvatar.textContent = user.username.charAt(0).toUpperCase();
            userAvatar.style.background = getRandomGradient();

            const registerDateObj = new Date(user.registerDate);
            registerDate.textContent = registerDateObj.toLocaleDateString('ru-RU');

            // Показываем игровой интерфейс
            authScreen.style.display = 'none';
            appContainer.style.display = 'block';

            // Инициализируем игру
            initGame();
        }

        function getRandomGradient() {
            const gradients = [
                'linear-gradient(135deg, #3b82f6, #8b5cf6)',
                'linear-gradient(135deg, #10b981, #0d9488)',
                'linear-gradient(135deg, #f59e0b, #d97706)',
                'linear-gradient(135deg, #ec4899, #be185d)',
                'linear-gradient(135deg, #8b5cf6, #7c3aed)'
            ];
            return gradients[Math.floor(Math.random() * gradients.length)];
        }

        // ================== ОСНОВНЫЕ ФУНКЦИИ ИГРЫ ==================
        function initGame() {
            // Инициализируем улучшения
            initializeUpgrades();

            // Настраиваем обработчики клика
            setupClickHandlers();

            // Инициализируем вкладки
            initTabs();

            // Настраиваем систему престижа
            setupPrestigeSystem();

            // Обновляем отображение
            updateDisplay();

            // Запускаем пассивный доход
            setInterval(passiveIncomeTick, 100);

            // Запускаем события
            startEventSystem();

            // Приветственное сообщение
            setTimeout(() => {
                showNotification('Добро пожаловать в Finance Empire! Начните кликать, чтобы построить свою финансовую империю!', 'info');
            }, 1000);
        }

        function initializeUpgrades() {
            // Собираем все улучшения
            const allUpgrades = [
                ...gameData.clickUpgrades,
                ...gameData.realEstateUpgrades,
                ...gameData.cryptoUpgrades,
                ...gameData.businessUpgrades,
                ...gameData.luxuryUpgrades
            ];

            // Инициализируем уровни
            allUpgrades.forEach(upgrade => {
                if (gameState.upgrades[upgrade.id] === undefined) {
                    gameState.upgrades[upgrade.id] = 0;
                }
            });
        }

        function setupClickHandlers() {
            clickButton.addEventListener('click', handleClick);
            clickButton.addEventListener('mousedown', handleMouseDown);
            clickButton.addEventListener('mouseup', handleMouseUp);
            clickButton.addEventListener('mouseleave', handleMouseUp);
        }

        // ================== ФУНКЦИИ ОБРАБОТКИ КЛИКОВ ==================
        let holdTimeout;
        let isHolding = false;

        function handleClick(event) {
            if (!isHolding) {
                addClickIncome();
            }
        }

        function handleMouseDown() {
            if (gameState.holdClickEnabled) {
                isHolding = true;
                holdTimeout = setTimeout(startAutoClicker, 500);
            }
        }

        function handleMouseUp() {
            isHolding = false;
            clearTimeout(holdTimeout);
        }

        function startAutoClicker() {
            if (isHolding) {
                addClickIncome();
                setTimeout(startAutoClicker, 100);
            }
        }

        function addClickIncome() {
            const income = gameState.clickIncome;
            gameState.money += income;
            gameState.totalClicks++;

            // Разблокировка автокликера
            if (!gameState.holdClickEnabled && gameState.totalClicks >= 1000) {
                gameState.holdClickEnabled = true;
                showNotification('Автокликер разблокирован! Удерживайте клик.', 'info');
            }

            createIncomePopup(income);
            updateDisplay();
        }

        function createIncomePopup(amount) {
            const popup = document.createElement('div');
            popup.className = 'income-popup';
            popup.textContent = `+${formatMoney(amount)}`;

            const rect = clickButton.getBoundingClientRect();
            const x = rect.left + rect.width / 2 - 30 + (Math.random() * 60 - 30);
            const y = rect.top - 30;

            popup.style.left = `${x}px`;
            popup.style.top = `${y}px`;

            document.body.appendChild(popup);

            setTimeout(() => {
                if (popup.parentNode) {
                    popup.parentNode.removeChild(popup);
                }
            }, 1000);
        }

        // ================== ФУНКЦИИ ФОРМАТИРОВАНИЯ ==================
        function formatMoney(amount) {
            if (isNaN(amount) || amount === null || amount === undefined) {
                return "$0";
            }

            amount = Number(amount);

            if (amount >= 1e12) {
                return "$" + (amount / 1e12).toFixed(2) + "T";
            }
            if (amount >= 1e9) {
                return "$" + (amount / 1e9).toFixed(2) + "B";
            }
            if (amount >= 1e6) {
                return "$" + (amount / 1e6).toFixed(2) + "M";
            }
            if (amount >= 1e3) {
                return "$" + (amount / 1e3).toFixed(2) + "K";
            }
            return "$" + amount.toFixed(2);
        }

        function getUpgradePrice(upgrade, level) {
            if (!upgrade || !upgrade.basePrice) return 0;
            let price = upgrade.basePrice * Math.pow(upgrade.priceMultiplier, level);

            // Скидка во время распродажи
            if (gameState.events.saleActive) {
                price *= 0.8;
            }

            return Math.floor(price);
        }

        // ================== РАСЧЕТ ДОХОДОВ ==================
        function calculateIncomes() {
            // Базовый множитель от престижа
            const prestigeMultiplier = 1 + (gameState.prestigeLevel * 0.5);
            gameState.clickMultiplier = prestigeMultiplier;

            // Доход за клик
            let clickIncome = 1;
            gameData.clickUpgrades.forEach(upgrade => {
                const level = gameState.upgrades[upgrade.id] || 0;
                if (gameState.prestigeLevel >= upgrade.prestigeUnlock) {
                    clickIncome += upgrade.incomePerLevel * level;
                }
            });

            // Умножаем на активные бусты
            if (gameState.events.boostActive) {
                clickIncome *= 2;
            }

            // Применяем множители событий
            currentActiveEvents.forEach(event => {
                if (event.type === 'boost') {
                    clickIncome *= 2;
                } else if (event.type === 'galaxy') {
                    clickIncome *= 5;
                }
            });

            gameState.clickIncome = clickIncome * prestigeMultiplier;

            // Пассивный доход
            let passiveIncome = 0;

            // Недвижимость
            gameData.realEstateUpgrades.forEach(upgrade => {
                const level = gameState.upgrades[upgrade.id] || 0;
                if (gameState.prestigeLevel >= upgrade.prestigeUnlock) {
                    passiveIncome += upgrade.incomePerLevel * level;
                }
            });

            // Криптовалюта
            gameData.cryptoUpgrades.forEach(upgrade => {
                const level = gameState.upgrades[upgrade.id] || 0;
                if (gameState.prestigeLevel >= upgrade.prestigeUnlock) {
                    passiveIncome += upgrade.incomePerLevel * level;
                }
            });

            // Бизнес
            gameData.businessUpgrades.forEach(upgrade => {
                const level = gameState.upgrades[upgrade.id] || 0;
                if (gameState.prestigeLevel >= upgrade.prestigeUnlock) {
                    passiveIncome += upgrade.incomePerLevel * level;
                }
            });

            // Роскошь
            gameData.luxuryUpgrades.forEach(upgrade => {
                const level = gameState.upgrades[upgrade.id] || 0;
                if (gameState.prestigeLevel >= upgrade.prestigeUnlock) {
                    passiveIncome += upgrade.incomePerLevel * level;
                }
            });

            // Применяем множители событий
            currentActiveEvents.forEach(event => {
                if (event.type === 'galaxy') {
                    passiveIncome *= 5;
                }
            });

            gameState.passiveIncome = passiveIncome * prestigeMultiplier;

            return {
                clickIncome: gameState.clickIncome,
                passiveIncome: gameState.passiveIncome
            };
        }

        // ================== ОБНОВЛЕНИЕ ИНТЕРФЕЙСА ==================
        function updateDisplay() {
            // Обновляем баланс
            balanceElement.textContent = formatMoney(gameState.money);
            balanceStatElement.textContent = formatMoney(gameState.money);

            // Обновляем престиж
            prestigeElement.textContent = gameState.prestigePoints;

            // Пересчитываем доходы
            const incomes = calculateIncomes();

            // Обновляем отображение доходов
            clickIncomeElement.textContent = formatMoney(incomes.clickIncome);
            clickValueElement.textContent = `+${formatMoney(incomes.clickIncome)}`;
            clickMultiplierElement.textContent = `Множитель: ${gameState.clickMultiplier.toFixed(1)}x`;
            incomePerSecElement.textContent = `${formatMoney(incomes.passiveIncome)}/сек`;

            // Обновляем прогресс бары
            updateProgressBars();

            // Обновляем все вкладки
            renderAllTabs();

            // Проверяем достижения
            checkAchievements();

            // Сохраняем пользователя
            if (userSystem.currentUser) {
                userSystem.currentUser.gameData = gameState;
                userSystem.saveCurrentUser();
            }
        }

        function updateProgressBars() {
            const nextMilestone = Math.pow(10, Math.floor(Math.log10(gameState.money + 1)) + 1);
            const moneyProgress = (gameState.money / nextMilestone) * 100;
            document.getElementById('money-progress').style.width = `${Math.min(moneyProgress, 100)}%`;

            const maxIncome = 10000 * (gameState.prestigeLevel + 1);
            const incomeProgress = (gameState.passiveIncome / maxIncome) * 100;
            document.getElementById('income-progress').style.width = `${Math.min(incomeProgress, 100)}%`;

            const maxClick = 1000 * (gameState.prestigeLevel + 1);
            const clickProgress = (gameState.clickIncome / maxClick) * 100;
            document.getElementById('click-progress').style.width = `${Math.min(clickProgress, 100)}%`;
        }

        // ================== СИСТЕМА ВКЛАДОК ==================
        function initTabs() {
            const tabs = document.querySelectorAll('.nav-tab');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });

                    const tabId = tab.getAttribute('data-tab');
                    document.getElementById(`${tabId}-tab`).classList.add('active');

                    // Особые обработки для вкладок
                    if (tabId === 'leaderboard') {
                        renderLeaderboard();
                    } else if (tabId === 'events') {
                        renderEventsTab();
                    }
                });
            });
        }

        function renderAllTabs() {
            renderTab('click');
            renderTab('real-estate');
            renderTab('crypto');
            renderTab('business');
            renderTab('luxury');
        }

        function renderTab(tabName) {
            const containerId = `${tabName}-upgrades-container`;
            const container = document.getElementById(containerId);
            if (!container) return;

            let upgrades = [];
            let typeClass = '';

            switch(tabName) {
                case 'click':
                    upgrades = gameData.clickUpgrades;
                    typeClass = 'click-type';
                    break;
                case 'real-estate':
                    upgrades = gameData.realEstateUpgrades;
                    typeClass = 'real-estate-type';
                    break;
                case 'crypto':
                    upgrades = gameData.cryptoUpgrades;
                    typeClass = 'crypto-type';
                    break;
                case 'business':
                    upgrades = gameData.businessUpgrades;
                    typeClass = 'business-type';
                    break;
                case 'luxury':
                    upgrades = gameData.luxuryUpgrades;
                    typeClass = 'luxury-type';
                    break;
            }

            container.innerHTML = '';

            // Рассчитываем сколько новых улучшений разблокировано каждые 10 престижей
            const newUpgradesCount = upgrades.filter(u =>
                u.prestigeUnlock > 0 &&
                u.prestigeUnlock <= gameState.prestigeLevel &&
                !gameState.unlockedPrestigeUpgrades?.includes(u.id)
            ).length;

            upgrades.forEach(upgrade => {
                // Проверяем доступность по престижу
                if (gameState.prestigeLevel < upgrade.prestigeUnlock) {
                    return;
                }

                // Отмечаем как разблокированное улучшение
                if (!gameState.unlockedPrestigeUpgrades?.includes(upgrade.id) && upgrade.prestigeUnlock > 0) {
                    if (!gameState.unlockedPrestigeUpgrades) gameState.unlockedPrestigeUpgrades = [];
                    gameState.unlockedPrestigeUpgrades.push(upgrade.id);

                    // Показываем уведомление о новом улучшении
                    if (newUpgradesCount > 0) {
                        showNotification(`Разблокировано новое улучшение: ${upgrade.name}!`, 'info');
                    }
                }

                const level = gameState.upgrades[upgrade.id] || 0;
                const price = getUpgradePrice(upgrade, level);
                const canBuy = gameState.money >= price && level < upgrade.maxLevel;
                const incomePerSecond = upgrade.incomePerLevel * level;

                const upgradeCard = document.createElement('div');
                upgradeCard.className = `upgrade-card ${typeClass}`;

                const prestigeBadge = upgrade.prestigeUnlock > 0 ?
                    `<div class="upgrade-multiplier">Престиж ${upgrade.prestigeUnlock}+</div>` : '';

                upgradeCard.innerHTML = `
                    <div class="upgrade-header">
                        <div class="upgrade-icon">
                            <i class="${upgrade.icon}"></i>
                        </div>
                        <div class="upgrade-info">
                            <div class="upgrade-name">${upgrade.name}</div>
                            <div class="upgrade-description">${upgrade.description}</div>
                        </div>
                    </div>
                    ${prestigeBadge}
                    <div class="upgrade-content">
                        <div class="upgrade-stats">
                            <div class="upgrade-stat">
                                <div class="stat-label-small">Уровень</div>
                                <div class="stat-value-small">${level}/${upgrade.maxLevel}</div>
                            </div>
                            <div class="upgrade-stat">
                                <div class="stat-label-small">Доход</div>
                                <div class="stat-value-small">${formatMoney(upgrade.incomePerLevel)}/сек</div>
                            </div>
                        </div>
                        <div class="upgrade-price">
                            <div class="price-value">${formatMoney(price)}</div>
                            ${gameState.events.saleActive ? '<div style="color: var(--accent2); font-size: 0.9rem; margin-top: 5px;">-20% Скидка!</div>' : ''}
                        </div>
                        <button class="upgrade-button" onclick="buyUpgrade(${upgrade.id})" ${canBuy ? '' : 'disabled'}>
                            <i class="fas fa-shopping-cart"></i>
                            ${level === 0 ? 'Купить' : 'Улучшить'}
                        </button>
                    </div>
                `;

                container.appendChild(upgradeCard);
            });

            // Обновляем счетчик новых улучшений в модальном окне престижа
            if (newUpgradesCountElement) {
                newUpgradesCountElement.textContent = newUpgradesCount;
            }
        }

        // ================== ЛИДЕРБОРД ==================
        function renderLeaderboard() {
            const leaderboardTable = document.getElementById('leaderboard-table');
            if (!leaderboardTable) return;

            const leaderboard = userSystem.leaderboard;
            const currentUserId = userSystem.currentUser?.id;

            leaderboardTable.innerHTML = `
                <div class="leaderboard-header">
                    <div>Ранг</div>
                    <div>Игрок</div>
                    <div>Уровень престижа</div>
                    <div>Очки престижа</div>
                    <div>Общий капитал</div>
                </div>
            `;

            leaderboard.forEach((player, index) => {
                const isCurrentUser = player.userId === currentUserId;
                const row = document.createElement('div');
                row.className = `leaderboard-row ${isCurrentUser ? 'current-user' : ''}`;

                const rankClass = index === 0 ? 'rank-1' :
                                 index === 1 ? 'rank-2' :
                                 index === 2 ? 'rank-3' : '';

                row.innerHTML = `
                    <div class="rank-cell ${rankClass}">
                        ${index + 1}
                    </div>
                    <div class="user-cell">
                        <div class="user-cell-avatar">${player.username.charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight: 600;">${player.username}</div>
                            ${isCurrentUser ? '<div style="color: var(--accent); font-size: 0.8rem;">Вы</div>' : ''}
                        </div>
                    </div>
                    <div>${player.prestigeLevel}</div>
                    <div>${formatMoney(player.prestigePoints)}</div>
                    <div>${formatMoney(player.totalMoney)}</div>
                `;

                leaderboardTable.appendChild(row);
            });

            // Если текущий пользователь не в топе, добавляем его отдельно
            if (currentUserId && !leaderboard.find(p => p.userId === currentUserId)) {
                const currentUser = userSystem.currentUser;
                const totalMoney = userSystem.calculateTotalMoney(gameState);

                const row = document.createElement('div');
                row.className = 'leaderboard-row current-user';
                row.innerHTML = `
                    <div class="rank-cell">-</div>
                    <div class="user-cell">
                        <div class="user-cell-avatar">${currentUser.username.charAt(0).toUpperCase()}</div>
                        <div>
                            <div style="font-weight: 600;">${currentUser.username}</div>
                            <div style="color: var(--accent); font-size: 0.8rem;">Вы</div>
                        </div>
                    </div>
                    <div>${gameState.prestigeLevel}</div>
                    <div>${formatMoney(gameState.prestigePoints)}</div>
                    <div>${formatMoney(totalMoney)}</div>
                `;

                leaderboardTable.appendChild(row);
            }
        }

        // ================== СИСТЕМА СОБЫТИЙ ==================
        function startEventSystem() {
            // Случайные события каждые 2-5 минут
            setInterval(() => {
                const availableEvents = eventSystem.getAvailableEvents(gameState.prestigeLevel);
                const event = availableEvents[Math.floor(Math.random() * availableEvents.length)];

                if (event && !currentActiveEvents.find(e => e.id === event.id)) {
                    activateEvent(event);
                }
            }, 120000 + Math.random() * 180000); // 2-5 минут

            // Ежедневный бонус каждые 24 часа
            setInterval(checkDailyBonus, 60000); // Проверка каждую минуту
        }

        function renderEventsTab() {
            const eventsContainer = document.getElementById('events-container');
            if (!eventsContainer) return;

            const availableEvents = eventSystem.getAvailableEvents(gameState.prestigeLevel);

            eventsContainer.innerHTML = '';

            availableEvents.forEach(event => {
                const isActive = currentActiveEvents.find(e => e.id === event.id);
                const eventCard = document.createElement('div');
                eventCard.className = 'event-card';
                eventCard.style.borderColor = event.color;

                let timerHtml = '';
                let actionButton = '';

                if (event.type === 'bonus') {
                    const timeSinceLastBonus = Date.now() - gameState.events.lastBonusTime;
                    const hoursUntilBonus = 24 - Math.floor(timeSinceLastBonus / (1000 * 60 * 60));

                    if (hoursUntilBonus <= 0) {
                        actionButton = `
                            <button class="upgrade-button" onclick="claimDailyBonus()" style="padding: 10px 20px; margin-top: 10px;">
                                <i class="fas fa-gift"></i> Получить бонус
                            </button>
                        `;
                        timerHtml = '<div style="color: var(--accent2);">Доступно сейчас!</div>';
                    } else {
                        timerHtml = `
                            <div class="stat-label-small">Доступно через:</div>
                            <div class="stat-value-small">${hoursUntilBonus}ч</div>
                        `;
                    }
                } else if (isActive) {
                    const timeLeft = eventTimers[event.id] ? Math.ceil((eventTimers[event.id].endTime - Date.now()) / 1000) : 0;
                    timerHtml = `
                        <div class="stat-label-small">Активно еще:</div>
                        <div class="stat-value-small">${timeLeft}с</div>
                    `;
                } else {
                    timerHtml = `
                        <div class="stat-label-small">Случайное событие</div>
                        <div class="stat-value-small">Скоро</div>
                    `;
                }

                eventCard.innerHTML = `
                    <div class="event-header">
                        <div class="event-icon" style="background: ${event.color}">
                            <i class="${event.icon}"></i>
                        </div>
                        <div>
                            <h3 style="font-size: 1.3rem; margin-bottom: 5px;">${event.name}</h3>
                            ${event.prestigeRequired ? `<p style="color: var(--accent3); font-size: 0.9rem;">Требуется: ${event.prestigeRequired}+ престиж</p>` : ''}
                        </div>
                    </div>
                    <div class="event-content">
                        <p>${event.description}</p>
                        <div class="event-timer">
                            ${timerHtml}
                            ${actionButton}
                        </div>
                    </div>
                `;

                eventsContainer.appendChild(eventCard);
            });
        }

        function activateEvent(event) {
            currentActiveEvents.push(event);

            // Устанавливаем таймер для завершения события
            const endTime = Date.now() + event.duration;
            eventTimers[event.id] = { endTime };

            // Применяем эффекты события
            switch(event.type) {
                case 'sale':
                    gameState.events.saleActive = true;
                    showNotification(`${event.name} активировано! Все улучшения -20%!`, 'info');
                    break;
                case 'boost':
                    gameState.events.boostActive = true;
                    showNotification(`${event.name} активировано! Доход за клик x2!`, 'info');
                    break;
                case 'galaxy':
                    showNotification(`${event.name} активировано! Все доходы x5!`, 'info');
                    break;
                case 'timewarp':
                    showNotification(`${event.name} активировано! Время ускоряется!`, 'info');
                    break;
            }

            // Обновляем интерфейс
            updateDisplay();
            renderEventsTab();

            // Таймер для завершения события
            setTimeout(() => {
                endEvent(event);
            }, event.duration);
        }

        function endEvent(event) {
            currentActiveEvents = currentActiveEvents.filter(e => e.id !== event.id);
            delete eventTimers[event.id];

            // Снимаем эффекты события
            switch(event.type) {
                case 'sale':
                    gameState.events.saleActive = false;
                    showNotification(`${event.name} завершено`, 'warning');
                    break;
                case 'boost':
                    gameState.events.boostActive = false;
                    showNotification(`${event.name} завершено`, 'warning');
                    break;
                default:
                    showNotification(`${event.name} завершено`, 'warning');
            }

            updateDisplay();
            renderEventsTab();
        }

        function claimDailyBonus() {
            const now = Date.now();
            const timeSinceLastBonus = now - gameState.events.lastBonusTime;

            if (timeSinceLastBonus < 24 * 60 * 60 * 1000) {
                showNotification('Бонус можно получить раз в 24 часа!', 'warning');
                return;
            }

            const bonus = 1000 * (gameState.prestigeLevel + 1);
            gameState.money += bonus;
            gameState.events.lastBonusTime = now;

            showNotification(`Получен ежедневный бонус: ${formatMoney(bonus)}!`, 'success');
            updateDisplay();
            renderEventsTab();
        }

        function checkDailyBonus() {
            // Автоматически обновляем таймер ежедневного бонуса
            if (document.getElementById('events-tab').classList.contains('active')) {
                renderEventsTab();
            }
        }

        // ================== ПОКУПКА УЛУЧШЕНИЙ ==================
        function buyUpgrade(upgradeId) {
            let upgrade = null;

            const allCategories = [
                gameData.clickUpgrades,
                gameData.realEstateUpgrades,
                gameData.cryptoUpgrades,
                gameData.businessUpgrades,
                gameData.luxuryUpgrades
            ];

            for (let category of allCategories) {
                upgrade = category.find(u => u.id === upgradeId);
                if (upgrade) break;
            }

            if (!upgrade) return;

            const level = gameState.upgrades[upgrade.id] || 0;
            const price = getUpgradePrice(upgrade, level);

            if (level >= upgrade.maxLevel) {
                showNotification('Достигнут максимальный уровень!', 'warning');
                return;
            }

            if (gameState.money < price) {
                showNotification('Недостаточно денег!', 'error');
                return;
            }

            gameState.money -= price;
            gameState.upgrades[upgrade.id] = level + 1;
            gameState.totalUpgrades++;

            updateDisplay();
            showNotification(`Куплено: ${upgrade.name} (ур. ${level + 1})`, 'success');
        }

        // ================== СИСТЕМА ПРЕСТИЖА ==================
        function setupPrestigeSystem() {
            prestigeButton.addEventListener('click', showPrestigeModal);
            modalClose.addEventListener('click', () => {
                prestigeModal.classList.remove('active');
            });
            confirmPrestige.addEventListener('click', performPrestige);
        }

        function calculatePrestigeReward() {
            const money = gameState.money;
            let reward = 0;

            if (money >= 10000000000) reward = Math.floor(money / 1000000000);
            else if (money >= 1000000000) reward = Math.floor(money / 100000000);
            else if (money >= 100000000) reward = Math.floor(money / 10000000);
            else if (money >= 10000000) reward = Math.floor(money / 1000000);
            else if (money >= 1000000) reward = Math.floor(money / 100000);

            return Math.max(reward, 0);
        }

        function showPrestigeModal() {
            const reward = calculatePrestigeReward();

            if (reward === 0) {
                showNotification('Нужно минимум 1,000,000$ для престижа!', 'warning');
                return;
            }

            // Считаем сколько новых улучшений будет разблокировано
            const newPrestigeLevel = gameState.prestigeLevel + 1;
            let newUpgradesCount = 0;

            const allUpgrades = [
                ...gameData.clickUpgrades,
                ...gameData.realEstateUpgrades,
                ...gameData.cryptoUpgrades,
                ...gameData.businessUpgrades,
                ...gameData.luxuryUpgrades
            ];

            allUpgrades.forEach(upgrade => {
                if (upgrade.prestigeUnlock === newPrestigeLevel) {
                    newUpgradesCount++;
                }
            });

            prestigeRewardElement.textContent = reward;
            prestigeMultiplierElement.textContent = `${1 + (newPrestigeLevel * 0.5)}x`;
            newUpgradesCountElement.textContent = newUpgradesCount;

            prestigeModal.classList.add('active');
        }

        function performPrestige() {
            const reward = calculatePrestigeReward();

            // Сохраняем очки престижа
            gameState.prestigePoints += reward;
            gameState.prestigeLevel++;

            // Сброс прогресса
            gameState.money = 100 + (gameState.prestigeLevel * 1000);
            gameState.upgrades = {};
            gameState.totalClicks = 0;
            gameState.totalUpgrades = 0;

            // Инициализируем заново
            initializeUpgrades();

            // Обновляем отображение
            updateDisplay();

            // Показываем уведомление
            showNotification(`Престиж достигнут! +${reward} очков престижа`, 'success');

            // Закрываем модальное окно
            prestigeModal.classList.remove('active');
        }

        // ================== ДОСТИЖЕНИЯ ==================
        function checkAchievements() {
            achievements.forEach((achievement, index) => {
                if (gameState.achievements[index] && !gameState.achievements[index].completed) {
                    let completed = false;

                    switch(achievement.id) {
                        case 1: // Первый миллионер
                            completed = gameState.money >= 1000000;
                            break;
                        case 2: // Клик-мастер
                            completed = gameState.totalClicks >= 10000;
                            break;
                        case 3: // Инвестор
                            completed = gameState.totalUpgrades >= 50;
                            break;
                        case 4: // Крипто-король
                            completed = gameState.upgrades[9] >= 50; // Bitcoin max level
                            break;
                        case 5: // Первый престиж
                            completed = gameState.prestigeLevel >= 1;
                            break;
                        case 6: // Властелин недвижимости
                            const realEstateIds = [5, 6, 7, 8, 22, 27, 32];
                            completed = realEstateIds.every(id => gameState.upgrades[id] > 0);
                            break;
                        case 7: // Империя бизнеса
                            const businessIds = [13, 14, 15, 16, 24, 29, 34];
                            completed = businessIds.every(id => gameState.upgrades[id] > 0);
                            break;
                        case 8: // Король роскоши
                            const luxuryIds = [17, 18, 19, 20, 25, 30, 35];
                            completed = luxuryIds.every(id => gameState.upgrades[id] > 0);
                            break;
                        case 9: // 10 уровней престижа
                            completed = gameState.prestigeLevel >= 10;
                            break;
                        case 10: // 50 уровней престижа
                            completed = gameState.prestigeLevel >= 50;
                            break;
                    }

                    if (completed) {
                        gameState.achievements[index].completed = true;
                        gameState.prestigePoints += achievement.reward;
                        showAchievement(achievement);
                    }
                }
            });
        }

        function showAchievement(achievement) {
            const badge = document.createElement('div');
            badge.className = 'achievement-badge';
            badge.innerHTML = `
                <i class="fas fa-trophy" style="color: var(--accent3);"></i>
                <div>
                    <div style="font-weight: 700;">Достижение разблокировано!</div>
                    <div style="font-size: 0.9rem; color: var(--text-secondary);">${achievement.name}</div>
                    <div style="font-size: 0.8rem; color: var(--accent2); margin-top: 5px;">+${achievement.reward} очков престижа</div>
                </div>
            `;

            document.body.appendChild(badge);

            setTimeout(() => {
                if (badge.parentNode) {
                    badge.parentNode.removeChild(badge);
                }
            }, 3000);
        }

        // ================== ПАССИВНЫЙ ДОХОД ==================
        function passiveIncomeTick() {
            if (gameState.passiveIncome > 0) {
                // Ускоряем время во время события временного разрыва
                let multiplier = 1;
                currentActiveEvents.forEach(event => {
                    if (event.type === 'timewarp') {
                        multiplier = 10;
                    }
                });

                gameState.money += (gameState.passiveIncome / 10) * multiplier;
                updateDisplay();
            }
        }

        // ================== УВЕДОМЛЕНИЯ ==================
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = 'notification';

            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';

            notification.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                if (notification.parentNode) {
                    notification.parentNode.removeChild(notification);
                }
            }, 2000);
        }

        // ================== ЗАПУСК ИГРЫ ==================
        document.addEventListener('DOMContentLoaded', () => {
            initAuth();

            // Автоматический вход, если есть сохраненная сессия
            const lastUser = localStorage.getItem('financeEmpireLastUser');
            if (lastUser) {
                const result = userSystem.login(lastUser, '');
                if (result.success) {
                    gameState = result.user.gameData;
                    showApp(result.user);
                }
            }
        });

        // ================== ГЛОБАЛЬНЫЕ ФУНКЦИИ ==================
        window.buyUpgrade = buyUpgrade;
        window.claimDailyBonus = claimDailyBonus;
    </script>
</body>
</html>